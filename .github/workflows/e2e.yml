name: cross browser end-to-end testing 🚀

on:
  workflow_dispatch:
  push:
    branches:
      - 'main'
  pull_request:
    types:
      - opened
  schedule:
    - cron: '0 2 * * *'

jobs:
  cypress-run:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code 🛎
        uses: actions/checkout@v3

      - name: Run docker-compose 🐳
        run: docker-compose up -d e2e-chrome e2e-firefox e2e-edge

      - name: Wait for services to start
        run: |
          docker-compose logs -f e2e-chrome > chrome-logs.txt &
          docker-compose logs -f e2e-firefox > firefox-logs.txt &
          docker-compose logs -f e2e-edge > edge-logs.txt

      - name: Archive and upload Chrome artifacts
        uses: actions/upload-artifact@v3
        with:
          name: chrome-artifacts
          path: |
            ./artifacts/chrome/videos
            ./artifacts/chrome/screenshots
            chrome-logs.txt

      - name: Archive and upload Firefox artifacts
        uses: actions/upload-artifact@v3
        with:
          name: firefox-artifacts
          path:
            ./artifacts/firefox/screenshots
            firefox-logs.txt

      - name: Archive and upload Edge artifacts
        uses: actions/upload-artifact@v3
        with:
          name: edge-artifacts
          path: |
            ./artifacts/edge/videos
            ./artifacts/edge/screenshots
            edge-logs.txt
